<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hermes API Quick Test</title>
  <style>
    body { font-family: system-ui, -apple-system, Roboto, "Segoe UI", Arial; margin: 24px; }
    pre { background:#f6f8fa; padding:12px; border-radius:6px; overflow:auto }
    .card { border:1px solid #e1e4e8; padding:12px; border-radius:8px; margin-bottom:12px }
    .headline { margin:4px 0; }
    button { padding:8px 12px; border-radius:6px; border:1px solid #0b5cff; background:#0b5cff; color:#fff }
    input[type=text] { padding:8px; border-radius:6px; border:1px solid #cbd5e1 }
  </style>
</head>
<body>
  <h1>Hermes quick API tester</h1>
  <p>Calls the local Node mock backend at <code>http://localhost:8080/ai-input</code>.</p>

  <div class="card">
    <label for="symbol">Symbol</label>
    <input id="symbol" type="text" value="BTCUSDT" />
    <button id="fetchBtn">Fetch</button>
  </div>

  <div id="status" class="card">Status: idle</div>

  <div id="market" class="card" hidden>
    <h3>Market</h3>
    <div id="ticker"></div>
    <h4>Recent Klines (last 5)</h4>
    <pre id="klines"></pre>
  </div>

  <div id="indicators" class="card" hidden>
    <h3>Indicators</h3>
    <pre id="indicatorsPre"></pre>
  </div>

  <div id="news" class="card" hidden>
    <h3>News (top 5)</h3>
    <div id="headlines"></div>
  </div>

  <div class="card">
    <h3>Raw JSON</h3>
    <pre id="raw">-</pre>
  </div>

  <script>
    const base = 'http://localhost:8080';
    const fetchBtn = document.getElementById('fetchBtn');
    const status = document.getElementById('status');
    const raw = document.getElementById('raw');
    const tickerEl = document.getElementById('ticker');
    const klinesEl = document.getElementById('klines');
    const headlinesEl = document.getElementById('headlines');
    const marketCard = document.getElementById('market');
    const indicatorsCard = document.getElementById('indicators');
    const newsCard = document.getElementById('news');

    async function fetchData() {
      const symbol = document.getElementById('symbol').value || 'BTCUSDT';
      const url = `${base}/ai-input?symbol=${encodeURIComponent(symbol)}`;
      status.textContent = 'Status: fetching...';
      try {
        const r = await fetch(url);
        if (!r.ok) throw new Error('HTTP ' + r.status);
        const j = await r.json();
        raw.textContent = JSON.stringify(j, null, 2);

        // market
        if (j.market && j.market.ticker) {
          marketCard.hidden = false;
          const t = j.market.ticker;
          tickerEl.innerHTML = `<strong>${t.symbol}</strong> — price: ${t.price} — change%: ${t.priceChangePercent}`;
          klinesEl.textContent = JSON.stringify((j.market.recentKlines || []).slice(0,5), null, 2);
        }

        // indicators
        if (j.indicators) {
          indicatorsCard.hidden = false;
          indicatorsPre.textContent = JSON.stringify(j.indicators, null, 2);
        }

        // news
        if (j.news && j.news.headlines) {
          newsCard.hidden = false;
          headlinesEl.innerHTML = '';
          (j.news.headlines || []).slice(0,5).forEach(h => {
            const d = document.createElement('div');
            d.className = 'headline';
            d.innerHTML = `<strong>${h.headline}</strong> <em>(${h.source})</em> — score: ${h.score}`;
            headlinesEl.appendChild(d);
          });
        }

        status.textContent = 'Status: OK';
      } catch (err) {
        status.textContent = 'Error: ' + err.message;
        raw.textContent = '';
        marketCard.hidden = true;
        indicatorsCard.hidden = true;
        newsCard.hidden = true;
      }
    }

    fetchBtn.addEventListener('click', fetchData);

    // auto-fetch on load
    window.addEventListener('load', () => setTimeout(fetchData, 150));
  </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hermes AI - Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #0A0E1A;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .result {
            background: #1A1F2E;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hermes AI Trading Companion - API Test</h1>
        
        <button class="test-button" onclick="testHealth()">Test Health</button>
        <button class="test-button" onclick="testAssets()">Test Assets</button>
        <button class="test-button" onclick="testMarketData()">Test Market Data</button>
        <button class="test-button" onclick="testPrediction()">Test Prediction</button>
        
        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000';
        
        function showResult(title, data) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result';
            resultDiv.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
            resultsDiv.appendChild(resultDiv);
        }
        
        async function testHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                showResult('Health Check', data);
            } catch (error) {
                showResult('Health Check Error', { error: error.message });
            }
        }
        
        async function testAssets() {
            try {
                const response = await fetch(`${API_BASE}/assets/search`);
                const data = await response.json();
                showResult('Assets', data);
            } catch (error) {
                showResult('Assets Error', { error: error.message });
            }
        }
        
        async function testMarketData() {
            try {
                const response = await fetch(`${API_BASE}/market/BTCUSDT/current`);
                const data = await response.json();
                showResult('Market Data (BTCUSDT)', data);
            } catch (error) {
                showResult('Market Data Error', { error: error.message });
            }
        }
        
        async function testPrediction() {
            try {
                const response = await fetch(`${API_BASE}/predictions/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ symbol: 'BTCUSDT' })
                });
                const data = await response.json();
                showResult('Prediction (BTCUSDT)', data);
            } catch (error) {
                showResult('Prediction Error', { error: error.message });
            }
        }
    </script>
</body>
</html>
